<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Portal QSSMA - Segurança do Trabalho">
  <meta name="theme-color" content="#b00000" />
  <title>Portal QSSMA - Segurança</title>
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="logo.jpg" type="image/jpg">
  
  <!-- CSS -->
  <link rel="stylesheet" href="styles.css">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<header>
  <img src="logo.jpg" alt="Portal QSSMA Logo" class="logo" loading="lazy" />
  <h1>PORTAL QSSMA - SEGURANÇA DO TRABALHO</h1>
  <div class="user-status" id="userStatus" style="display:none">
    <span id="userName"></span>
    <button class="logout-btn" onclick="window.logout()" title="Sair">
      <i class="fas fa-sign-out-alt"></i>
    </button>
  </div>
</header>

<div class="top-actions container">
  <div>
    <button class="icon-btn" id="installBtn" style="display:none" aria-label="Instalar aplicativo">
      <i class="fas fa-download"></i> Instalar App
    </button>
  </div>
  <div>
    <button class="icon-btn" id="altoContrasteBtn" title="Modo Alto Contraste" aria-label="Modo para uso externo">
      <i class="fas fa-sun"></i> Modo Externo
    </button>
    <button class="icon-btn" id="darkToggle" title="Alternar tema" aria-label="Alternar tema claro/escuro">
      <i class="fas fa-moon"></i>
    </button>
    <span class="connection-status" id="connectionStatus" title="Status da conexão">
      <i class="fas fa-circle"></i>
    </span>
  </div>
</div>

<main class="container">

  <!-- TELA DE BOAS VINDAS -->
  <section id="welcome" class="tela ativa">
    <div class="welcome-content">
      <img src="avatar.png" class="avatar grande" alt="Avatar QSSMA" loading="lazy" />
      <div class="welcome-text">
        <h2><i class="fas fa-shield-alt"></i> Bem-vindo ao Portal QSSMA</h2>
        <p>Sistema de Gestão de Segurança, Saúde e Meio Ambiente</p>
        <div class="alert-card">
          <div class="alert-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="alert-content">
            <strong>Importante:</strong> Registre todos os eventos de segurança. Sua atenção salva vidas!
          </div>
        </div>
        <button class="btn btn-primary btn-large" id="entrarBtn">
          <i class="fas fa-sign-in-alt"></i> Acessar Portal
        </button>
      </div>
    </div>
  </section>

  <!-- TELA: ESCOLHA DE PERFIL -->
  <section id="telaEscolhaPerfil" class="tela hidden">
    <div class="section-header">
      <h2><i class="fas fa-user-circle"></i> Como você está acessando?</h2>
      <p>Selecione seu perfil para continuar</p>
    </div>
    
    <div class="cards-grid">
      <div class="profile-card" data-perfil="usuario">
        <div class="card-icon usuario">
          <i class="fas fa-user-hard-hat"></i>
        </div>
        <h3>Colaborador</h3>
        <p>Acesso para registro de eventos e inspeções de segurança</p>
        <div class="card-features">
          <span><i class="fas fa-clipboard-check"></i> Inspeções</span>
          <span><i class="fas fa-exclamation-circle"></i> Eventos</span>
          <span><i class="fas fa-bell"></i> Avisos</span>
        </div>
      </div>
      
      <div class="profile-card" data-perfil="gestor">
        <div class="card-icon gestor">
          <i class="fas fa-user-tie"></i>
        </div>
        <h3>Gestor QSSMA</h3>
        <p>Acesso administrativo para gestão e monitoramento</p>
        <div class="card-features">
          <span><i class="fas fa-chart-line"></i> Dashboard</span>
          <span><i class="fas fa-bullhorn"></i> Avisos</span>
          <span><i class="fas fa-shield-alt"></i> Controle</span>
        </div>
      </div>
    </div>
    
    <div class="action-footer">
      <button class="btn btn-secondary" id="voltarInicioBtn">
        <i class="fas fa-arrow-left"></i> Voltar
      </button>
    </div>
  </section>

  <!-- TELA: LOGIN USUÁRIO -->
  <section id="tela-usuario-login" class="tela hidden">
    <div class="section-header">
      <h2><i class="fas fa-user-hard-hat"></i> Acesso do Colaborador</h2>
      <p>Informe sua matrícula para continuar</p>
    </div>
    
    <div class="auth-card">
      <div class="auth-icon">
        <i class="fas fa-id-card"></i>
      </div>
      
      <div class="form-group">
        <label for="matriculaUsuario">
          <i class="fas fa-hashtag"></i> Matrícula
        </label>
        <input
          id="matriculaUsuario"
          type="text"
          placeholder="Digite sua matrícula"
          class="form-input"
          aria-label="Matrícula do colaborador"
          maxlength="10"
          autocomplete="off"
        />
        <div class="form-hint">
          <i class="fas fa-info-circle"></i> Informe sua matrícula cadastrada
        </div>
      </div>
      
      <button class="btn btn-primary btn-block" id="loginUsuarioBtn">
        <i class="fas fa-sign-in-alt"></i> Entrar
      </button>
      
      <div class="auth-footer">
        <p><i class="fas fa-exclamation-triangle"></i> Problemas com acesso? Procure o Gestor de QSSMA</p>
      </div>
    </div>
    
    <div class="action-footer">
      <button class="btn btn-secondary" id="voltarPerfilUsuarioBtn">
        <i class="fas fa-arrow-left"></i> Voltar
      </button>
    </div>
  </section>

  <!-- TELA: USUÁRIO AUTENTICADO -->
  <section id="tela-usuario" class="tela hidden">
    <div class="user-header">
      <div class="user-avatar">
        <i class="fas fa-user-circle"></i>
      </div>
      <div class="user-info">
        <h2>Olá, <span id="usuarioNome"></span>!</h2>
        <div class="user-details">
          <span class="user-badge">
            <i class="fas fa-id-card"></i> Matrícula: <span id="usuarioMatricula"></span>
          </span>
          <span class="user-badge">
            <i class="fas fa-briefcase"></i> Função: <span id="usuarioFuncao"></span>
          </span>
          <span class="user-badge">
            <i class="fas fa-building"></i> Setor: Segurança
          </span>
        </div>
      </div>
    </div>
    
    <div class="cards-grid">
      <div class="feature-card" data-form="evento">
        <div class="card-icon danger">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3>INFORME DE EVENTO</h3>
        <p>Registre incidentes, acidentes e quase acidentes</p>
      </div>
      
      <div class="feature-card" data-form="radar">
        <div class="card-icon warning">
          <i class="fas fa-tachometer-alt"></i>
        </div>
        <h3>RADAR DE VELOCIDADE</h3>
        <p>Registro de controle de velocidade em áreas da obra</p>
      </div>
      
      <div class="feature-card" data-form="flash">
        <div class="card-icon success">
          <i class="fas fa-bolt"></i>
        </div>
        <h3>FLASH REPORT</h3>
        <p>Relatos rápidos de segurança e boas práticas</p>
      </div>
      
      <div class="feature-card" id="avisosBtn">
        <div class="card-icon info">
          <i class="fas fa-bullhorn"></i>
        </div>
        <h3>Avisos & Comunicados</h3>
        <p>Informações importantes da segurança</p>
        <span class="badge" id="avisosCount" style="display:none">0</span>
      </div>
      
      <div class="feature-card whatsapp" id="whatsappBtn">
        <div class="card-icon">
          <i class="fab fa-whatsapp"></i>
        </div>
        <h3>Suporte WhatsApp</h3>
        <p>Contato de emergência QSSMA</p>
      </div>
    </div>
    
    <div class="action-footer">
      <button class="btn btn-secondary" id="logoutUsuarioBtn">
        <i class="fas fa-sign-out-alt"></i> Sair
      </button>
    </div>
  </section>

  <!-- TELA: LOGIN GESTOR -->
  <section id="tela-gestor-login" class="tela hidden">
    <div class="section-header">
      <h2><i class="fas fa-user-tie"></i> Acesso do Gestor</h2>
      <p>Acesso restrito à equipe de gestão QSSMA</p>
    </div>
    
    <div class="auth-card">
      <div class="auth-icon gestor">
        <i class="fas fa-shield-alt"></i>
      </div>
      
      <div class="form-group">
        <label for="gestorEmail">
          <i class="fas fa-envelope"></i> E-mail
        </label>
        <input type="email" id="gestorEmail" placeholder="seu@email.com" class="form-input" />
      </div>
      
      <div class="form-group">
        <label for="gestorSenha">
          <i class="fas fa-lock"></i> Senha
        </label>
        <input type="password" id="gestorSenha" placeholder="Sua senha" class="form-input" />
      </div>
      
      <button class="btn btn-primary btn-block" id="loginGestorBtn">
        <i class="fas fa-sign-in-alt"></i> Entrar
      </button>
      
      <div class="auth-footer">
        <p><i class="fas fa-exclamation-circle"></i> Acesso restrito aos gestores autorizados</p>
      </div>
    </div>
    
    <div class="action-footer">
      <button class="btn btn-secondary" id="voltarPerfilGestorBtn">
        <i class="fas fa-arrow-left"></i> Voltar
      </button>
    </div>
  </section>

  <!-- TELA: GESTOR DASHBOARD -->
  <section id="tela-gestor-dashboard" class="tela hidden">
    <div class="section-header">
      <h2><i class="fas fa-tachometer-alt"></i> Painel de Controle QSSMA</h2>
      <p>Dashboard administrativo - Monitoramento de segurança</p>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon primary">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3 id="totalColaboradores">0</h3>
          <p>Colaboradores</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon warning">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
          <h3 id="eventosHoje">0</h3>
          <p>Eventos Hoje</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon info">
          <i class="fas fa-bullhorn"></i>
        </div>
        <div class="stat-content">
          <h3 id="totalAvisos">0</h3>
          <p>Avisos Ativos</p>
        </div>
      </div>
    </div>
    
    <div class="cards-grid">
      <div class="feature-card" id="gerenciarAvisosBtn">
        <div class="card-icon info">
          <i class="fas fa-bullhorn"></i>
        </div>
        <h3>Gerenciar Avisos</h3>
        <p>Crie e edite avisos para os colaboradores</p>
      </div>
      
      <div class="feature-card" data-form="evento" data-iframe="true">
        <div class="card-icon danger">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3>Registrar Evento</h3>
        <p>Registro administrativo de eventos</p>
      </div>
      
      <div class="feature-card" data-form="flash" data-iframe="true">
        <div class="card-icon success">
          <i class="fas fa-bolt"></i>
        </div>
        <h3>Flash Report</h3>
        <p>Registros rápidos administrativos</p>
      </div>
      
      <div class="feature-card" id="verAvisosBtn">
        <div class="card-icon warning">
          <i class="fas fa-bell"></i>
        </div>
        <h3>Ver Avisos</h3>
        <p>Visualize todos os avisos ativos</p>
      </div>
      
      <div class="feature-card whatsapp" id="whatsappGestorBtn">
        <div class="card-icon">
          <i class="fab fa-whatsapp"></i>
        </div>
        <h3>Suporte WhatsApp</h3>
        <p>Contato de emergência</p>
      </div>
    </div>
    
    <div class="action-footer">
      <button class="btn btn-secondary" id="logoutGestorBtn">
        <i class="fas fa-sign-out-alt"></i> Sair
      </button>
    </div>
  </section>

  <!-- TELA: FORMULÁRIO EM IFRAME -->
  <section id="tela-formulario-iframe" class="tela hidden">
    <div class="formulario-header">
      <h2><i class="fas fa-clipboard-list"></i> <span id="formTitle"></span></h2>
      <button class="btn btn-secondary" id="fecharFormularioBtn">
        <i class="fas fa-arrow-left"></i> Voltar
      </button>
    </div>
    
    <div class="iframe-container" id="iframeContainer">
      <iframe 
        id="formIframe" 
        src="about:blank"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
        allow="camera *; microphone *"
      ></iframe>
    </div>
  </section>

</main>

<!-- MODAIS -->
<div id="avisosModal" class="modal-back" aria-hidden="true" style="display:none">
  <div class="modal">
    <button class="close" id="closeAvisosModal" aria-label="Fechar">✕</button>
    <h3><i class="fas fa-bullhorn"></i> Avisos e Comunicados</h3>
    <div class="avisos-list" id="avisosDinamicos">
      <div class="loading-state">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Carregando avisos...</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" id="fecharAvisosBtn">Fechar</button>
    </div>
  </div>
</div>

<!-- LOADING OVERLAY -->
<div id="loadingOverlay" class="loading-overlay" style="display:none">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <p id="loadingText">Carregando...</p>
  </div>
</div>

<!-- OFFLINE BANNER -->
<div id="offlineBanner" class="offline-banner" style="display:none">
  <i class="fas fa-wifi-slash"></i>
  <span>Você está offline. Algumas funcionalidades podem não estar disponíveis.</span>
</div>

<!-- JS -->
<script type="module" src="firebase.js"></script>
<script type="module" src="app.js"></script>
</body>
</html>
